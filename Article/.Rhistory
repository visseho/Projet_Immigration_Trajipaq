library(summarytools)
library(tidyverse)
library(ggthemes)
library(haven)
trajipaq <- read_dta("../Data/Base_Trajipaq_Finale_Ok.dta")
trajipaq <-
trajipaq %>%
mutate(EDUCATION = factor(case_when(
Q26 == 1 ~ "Elementaire",
Q26 == 2 ~ "Secondaire",
Q26 == 3 ~ "Collegial",
Q26 == 4 ~ "Post secondaire",
Q26 == 5 ~ "Universitaire",
Q26 == 6 ~ NA,
Q26 == 98 ~ NA,
Q26 == 99 ~ NA
), levels = c("Elementaire", "Secondaire", "Post secondaire", "Collegial", "Universitaire")))
ggplot(subset(trajipaq, !is.na(EDUCATION)), aes(x = EDUCATION)) +
geom_bar(fill = "pink") +
labs(
title = "Distribution du niveau d'education",
x = "Niveau d'education"
) +
coord_flip() +
theme_bw()
freq(trajipaq$Q39A)
?mutate_at
trajipaq <-
trajipaq %>%
mutate(Q39A = Q39_new_A,
Q39B = Q39_new_B,
Q39C = Q39_new_C,
Q39D = Q39_new_D) %>%
mutate_at(
vars(starts_with("Q39_new")),
funs(case_when(
. == 1 ~ 4,
. == 2 ~ 3,
. == 3 ~ 2,
. == 4 ~ 1,
. == 98 ~ NA,
. == 99 ~ NA
))
)
trajipaq <-
trajipaq %>%
mutate(Q39_new_A = Q39A,
Q39_new_B = Q39B,
Q39_new_C = Q39C,
Q39_new_D = Q39D) %>%
mutate_at(
vars(starts_with("Q39_new")),
funs(case_when(
. == 1 ~ 4,
. == 2 ~ 3,
. == 3 ~ 2,
. == 4 ~ 1,
. == 98 ~ NA,
. == 99 ~ NA
))
)
ctable(trajipaq$Q39A, trajipaq$Q39_new_A)
ctable(trajipaq$Q39A, trajipaq$Q39_new_A, "no")
nbre_lvl <- 3 # nombre de réponses possibles
trajipaq <-
trajipaq %>%
rowwise() %>%
mutate(VD1 = (sum(c_across(all_of(v_VD1)), na.rm = TRUE) - length(v_VD1)) / ((nbre_lvl - 1)*length(v_VD1)))
v_VD1 <- c(
"Q39_new_A",
"Q39_new_B",
"Q39_new_C",
"Q39_new_D"
)
nbre_lvl <- 4 # nombre de réponses possibles
trajipaq <-
trajipaq %>%
rowwise() %>%
mutate(VD1 = (sum(c_across(all_of(v_VD1)), na.rm = TRUE) - length(v_VD1)) / ((nbre_lvl - 1)*length(v_VD1)))
View(trajipaq)
?slice()
trajipaq <-
trajipaq %>%
mutate(nbre_rep_rep = rowSums(!is.na(select(., starts_with("Q39_new")))))
trajipaq <-
trajipaq %>%
mutate(nbre_rep_rep = rowSums(!is.na(select(., starts_with("Q39_new")))))
trajipaq <-
trajipaq %>%
mutate(nbre_rep_rep = rowSums(!is.na(select(., starts_with("Q39_new")))))
trajipaq <-
trajipaq %>%
mutate(nbre_rep_rep = list(rowSums(!is.na(select(., starts_with("Q39_new"))))))
View(trajipaq)
trajipaq <-
trajipaq %>%
mutate(nbre_rep_rep = rowSums(!is.na(starts_with("Q39_new"))))
trajipaq <-
trajipaq %>%
mutate_at(nbre_rep_rep = rowSums(!is.na(starts_with("Q39_new"))))
trajipaq <-
trajipaq %>%
mutate_at(
vars(starts_with("Q39_new")),
nbre_rep_rep = rowSums(!is.na(.)))
?across
trajipaq <-
trajipaq %>%
mutate (nbre_rep_rep = sum(is.na(across(starts_with("Q39_new")))))
View(trajipaq)
trajipaq <-
trajipaq %>%
mutate (nbre_rep_rep = sum(!is.na(across(starts_with("Q39_new")))))
freq(trajipaq$nbre_rep_rep)
trajipaq <-
trajipaq %>%
rowwise() %>%
mutate(VD1_new = (sum(c_across(all_of(v_VD1)), na.rm = TRUE) - (nbre_rep_rep)) / ((nbre_lvl - 1)*nbre_rep_rep)) %>%
mutate(VD1_new = if (nbre_rep_rep == 0) NA_real_ else VD1) %>%
ungroup()
trajipaq <-
trajipaq %>%
rowwise() %>%
mutate(VD1 = (sum(c_across(all_of(v_VD1)), na.rm = TRUE) - length(v_VD1)) / ((nbre_lvl - 1)*length(v_VD1))) %>%
mutate(VD1 = if (VD1 < 0) NA_real_ else VD1) %>%
ungroup()
trajipaq <-
trajipaq %>%
rowwise() %>%
mutate(VD1_new = (sum(c_across(all_of(v_VD1)), na.rm = TRUE) - nbre_rep_rep) / ((nbre_lvl - 1)*nbre_rep_rep)) %>%
mutate(VD1_new = if (nbre_rep_rep == 0) NA_real_ else VD1) %>%
ungroup()
nbre_lvl <- 4 # nombre de réponses possibles
trajipaq <-
trajipaq %>%
rowwise() %>%
mutate(VD1 = (sum(c_across(all_of(v_VD1)), na.rm = TRUE) - length(v_VD1)) / ((nbre_lvl - 1)*length(v_VD1))) %>%
mutate(VD1 = if (VD1 < 0) NA_real_ else VD1) %>%
ungroup()
trajipaq <-
trajipaq %>%
mutate (nbre_rep_rep = sum(!is.na(across(starts_with("Q39_new")))))
trajipaq <-
trajipaq %>%
rowwise() %>%
mutate(VD1_new = (sum(c_across(all_of(v_VD1)), na.rm = TRUE) - nbre_rep_rep) / ((nbre_lvl - 1)*nbre_rep_rep)) %>%
mutate(VD1_new = if (nbre_rep_rep == 0) NA_real_ else VD1) %>%
ungroup()
trajipaq <-
trajipaq %>%
mutate (nbre_rep_rep = sum(!is.na(across(starts_with("Q39_new")))))
trajipaq <-
trajipaq %>%
mutate (nbre_rep_rep = sum(is.na(across(starts_with("Q39_new")))))
trajipaq <-
trajipaq %>%
rowwise() %>%
mutate (nbre_rep_rep = sum(!is.na(across(starts_with("Q39_new")))))
trajipaq <-
trajipaq %>%
rowwise() %>%
mutate(VD1_new = (sum(c_across(all_of(v_VD1)), na.rm = TRUE) - nbre_rep_rep) / ((nbre_lvl - 1)*nbre_rep_rep)) %>%
mutate(VD1_new = if (nbre_rep_rep == 0) NA_real_ else VD1) %>%
ungroup()
trajipaq <-
trajipaq %>%
rowwise() %>%
mutate(sumVD1 = sum(c_across(all_of(v_VD1)), na.rm = TRUE)) %>%
mutate(VD1_new = (sumVD1 - nbre_rep_rep) / ((nbre_lvl - 1)*nbre_rep_rep)) %>%
mutate(VD1_new = if (nbre_rep_rep == 0) NA_real_ else VD1) %>%
ungroup()
trajipaq <-
trajipaq %>%
rowwise() %>%
mutate(sumVD1 = sum(c_across(all_of(v_VD1)), na.rm = TRUE)) %>%
mutate(VD1_new = (sumVD1 - nbre_rep_rep) / ((nbre_lvl - 1)*nbre_rep_rep)) %>%
mutate(VD1_new = if (nbre_rep_rep == 0) NA_real_ else VD1) %>%
ungroup()
trajipaq <-
trajipaq %>%
rowwise() %>%
mutate(sumVD1 = sum(c_across(all_of(v_VD1)), na.rm = TRUE)) %>%
mutate(VD1_new = (sumVD1 - nbre_rep_rep) / ((nbre_lvl - 1)*nbre_rep_rep)) %>%
mutate(VD1_new = if (nbre_rep_rep == 0) NA_real_ else VD1_new) %>%
ungroup()
trajipaq <-
trajipaq %>%
rowwise() %>%
mutate(sumVD1 = sum(c_across(all_of(v_VD1)), na.rm = TRUE)) %>%
mutate(VD1_new = (sumVD1 - nbre_rep_rep) / ((nbre_lvl - 1)*nbre_rep_rep)) %>%
mutate(VD1_new = if (nbre_rep_rep == 0) NA_real_ else VD1_new) %>%
ungroup()
descr(trajipaq$VD1_new)
ggplot(data = trajipaq, mapping = aes(x = VD1_new)) +
geom_histogram(na.rm = TRUE, fill = "pink", binwidth = 0.01) +
labs(
title = "Distribution du sentiment d'appartenance au Quebec",
x = "Indice du sentiment d'appartenance au Quebec"
) +
theme_bw()
freq(trajipaq$VD2)
trajipaq <-
trajipaq %>%
mutate(VD2 = case_when(
Q39E == 1 ~ "Oui",
Q39E == 2 ~ "Oui",
Q39E == 3 ~ "Non",
Q39E == 4 ~ "Non",
Q39E == 98 ~ NA,
Q39E == 99 ~ NA
))
freq(trajipaq$VD2)
trajipaq <-
trajipaq %>%
mutate(VD3 = case_when(
Q39F == 1 ~ "Oui",
Q39F == 2 ~ "Oui",
Q39F == 3 ~ "Non",
Q39F == 4 ~ "Non",
Q39F == 98 ~ NA,
Q39F == 99 ~ NA
))
freq(trajipaq$VD3)
trajipaq <-
trajipaq %>%
mutate(VD4= case_when(
VD2 == "Oui" & VD3 == "Oui" ~ "Intégré",
VD2 == "Oui" & VD3 == "Non" ~ "Assimilé",
VD2 == "Non" & VD3 == "Oui" ~ "Séparé",
VD2 == "Non" & VD3 == "Non" ~ "Marginalisé"
))
freq(trajipaq$VD4)
trajipaq <-
trajipaq %>%
mutate(Q39D0uinon = if_else(Q39D <= 2, "Oui", "Non"))
trajipaq <-
trajipaq %>%
mutate(Q39D0uinon = if_else(Q39D <= 2, "Oui", "Non"))
ctable(trajipaq$Q39D, trajipaq$Q39Douinon)
trajipaq <-
trajipaq %>%
mutate(Q39Douinon = if_else(Q39D <= 2, "Oui", "Non"))
ctable(trajipaq$Q39D, trajipaq$Q39Douinon)
ctable(trajipaq$Q39D, trajipaq$Q39Douinon, "no")
trajipaq <-
trajipaq %>%
mutate(Q39Douinon = if_else(Q39D <= 2, "Oui", "Non", 97/98 = NA_real))
trajipaq <-
trajipaq %>%
mutate(Q39Douinon = if_else(Q39D <= 2, "Oui", "Non", 97:98 = NA_real))
trajipaq <-
trajipaq %>%
mutate(Q39Douinon = if_else(Q39D <= 2, "Oui", "Non", 97 = NA_real))
ctable(trajipaq$Q39D, trajipaq$Q39Douinon, "no")
trajipaq <-
trajipaq %>%
mutate(Q39Douinon = if_else(Q39D <= 2, "Oui", "Non", 98 = NA_real))
?replace
trajipaq <-
trajipaq %>%
mutate(Q39Douinon = if_else(Q39D <= 2, "Oui", "Non", 98 = NA_real)) %>%
trajipaq <-
trajipaq %>%
mutate(Q39Douinon = case_when(
Q39D <= 2 ~ "Oui",
Q39D == 3 | Q39D == 4 ~ "Non",
Q39D >= 97 = NA_real))
trajipaq <-
trajipaq %>%
mutate(Q39Douinon = case_when(
Q39D <= 2 ~ "Oui",
Q39D == 3 | Q39D == 4 ~ "Non",
Q39D >= 97 = NA_real_))
trajipaq <-
trajipaq %>%
mutate(Q39Douinon = case_when(
Q39D <= 2 ~ "Oui",
Q39D == 3 | Q39D == 4 ~ "Non",
Q39D >= 97 = NA))
trajipaq <-
trajipaq %>%
mutate(Q39Douinon = case_when(
Q39D <= 2 ~ "Oui",
Q39D == 3 | Q39D == 4 ~ "Non",
Q39D >= 97 = NA_character_))
trajipaq <-
trajipaq %>%
mutate(Q39Douinon = case_when(
Q39D <= 2 ~ "Oui",
Q39D == 3 | Q39D == 4 ~ "Non",
Q39D >= 97 ~ NA_character_))
ctable(trajipaq$Q39D, trajipaq$Q39Douinon, "no")
trajipaq <-
trajipaq %>%
mutate(VD5= factor(case_when(
VD2 == "Oui" & VD39Douinon == "Oui" ~ 1,
VD2 == "Oui" & VD3 == "Non" ~ 2,
VD2 == "Non" & VD3 == "Oui" ~ 3,
VD2 == "Non" & VD3 == "Non" ~ 4
),
labels = c("Canada et Québec", "Canada seule", "Québec seule", "Aucun"),
levels = c("Canada et Québec", "Canada seule", "Québec seule", "Aucun")))
trajipaq <-
trajipaq %>%
mutate(VD5= factor(case_when(
VD2 == "Oui" & VD39Douinon == "Oui" ~ 1,
VD2 == "Oui" & VD39Douinon == "Non" ~ 2,
VD2 == "Non" & VD39Douinon == "Oui" ~ 3,
VD2 == "Non" & VD39Douinon == "Non" ~ 4
),
labels = c("Canada et Québec", "Canada seule", "Québec seule", "Aucun"),
levels = c("Canada et Québec", "Canada seule", "Québec seule", "Aucun")))
trajipaq <-
trajipaq %>%
mutate(VD5= factor(case_when(
VD2 == "Oui" & Q39Douinon == "Oui" ~ 1,
VD2 == "Oui" & Q39Douinon == "Non" ~ 2,
VD2 == "Non" & Q39Douinon == "Oui" ~ 3,
VD2 == "Non" & Q39Douinon == "Non" ~ 4
),
labels = c("Canada et Québec", "Canada seule", "Québec seule", "Aucun"),
levels = c("Canada et Québec", "Canada seule", "Québec seule", "Aucun")))
freq(trajipaq$VD5)
ctable(trajipaq$Q39D, trajipaq$Q39Douinon, "no")
trajipaq <-
trajipaq %>%
mutate(VD5= factor(case_when(
VD2 == "Oui" & Q39Douinon == "Oui" ~ 1,
VD2 == "Oui" & Q39Douinon == "Non" ~ 2,
VD2 == "Non" & Q39Douinon == "Oui" ~ 3,
VD2 == "Non" & Q39Douinon == "Non" ~ 4
),
#labels = c("Canada et Québec", "Canada seule", "Québec seule", "Aucun"),
levels = c("Canada et Québec", "Canada seule", "Québec seule", "Aucun")))
freq(trajipaq$VD5)
trajipaq <-
trajipaq %>%
mutate(VD5= factor(case_when(
VD2 == "Oui" & Q39Douinon == "Oui" ~ 1,
VD2 == "Oui" & Q39Douinon == "Non" ~ 2,
VD2 == "Non" & Q39Douinon == "Oui" ~ 3,
VD2 == "Non" & Q39Douinon == "Non" ~ 4
),
labels = c("Canada et Québec", "Canada seule", "Québec seule", "Aucun"),
levels = c(1, 2, 3, 4)))
freq(trajipaq$VD5)
